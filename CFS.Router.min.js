(function(f,e){f.define?define(e):(f.cfs=f.cfs||{},f.cfs.router=e())})(window,function(){function f(a,d){if(!this.events[a])return!1;for(var b=0,c=this.events[a].length;b<c;b++)this.events[a][b].apply(this,d)}function e(a){if(!(this instanceof e))return new e(a);if(!window.history||!window.history.pushState)throw Error("not support pushState");this._maps={};this.param=a||{};this.events={};this._rest=null}var h=window.location,g={getParamType:function(a){return("object"===(_t=typeof a)?Object.prototype.toString.call(a).slice(8,-1):_t).toLowerCase()},isNotEmptyString:function(a){return"string"===g.getParamType(a)&&a.length},pathParser:function(a){a=a.replace(/^\/*|\/*$/g,"");a=a.split(/\//);1===a.length&&""===a[0]&&(a=[]);return a},searchParser:function(a){var d={},b=[],c=[];if(a){b=a.split("&");a=0;for(var g=b.length;a<g;a++)b[a]&&(c=b[a].split("="),d[c[0]]="undefined"===typeof c[1]?"":c[1])}return d},findPathInMaps:function(a,d){var b=null,c=[],f=!1,e={},h;for(h in d)if(c=g.pathParser(h),c.length===a.length){for(var b=d[h],k=0,l=c.length;k<l;k++)if(c[k]!==a[k])if(f=c[k].match(/\:(.+)/))e[f[1]]=c[k];else{b=null;e={};break}if(b)break}return b?{target:b,data:e}:null}};e.prototype={set:function(a,d){var b=[],c=g.getParamType(a);"string"===c?b=[a]:"array"===c&&(b=a);for(var c=0,e=b.length;c<e;c++)this._maps[b[c]]={render:"function"===typeof d?d:null};return this},title:function(a){document.title=a},rest:function(a){"function"===g.getParamType(a)&&(this._rest=a);return this},on:function(a,d){this.events[a]||(this.events[a]=[]);this.events[a].push(d);return this},push:function(a){window.history.pushState({url:a},"",a)},refresh:function(a){a=a?a:h.pathname+h.search+h.hash;var d=g.isNotEmptyString(a)?a.split("?"):["",""];a=g.pathParser(d[0].split("#")[0]);var d=g.searchParser(d[1]),b=g.findPathInMaps(a,this._maps),c;console.log(">>",b);f.call(this,"beforeRefresh",[a,d]);b?(c=b.data,console.log(b.target),b.target.render.call(this,c,a,d)):this._rest&&this._rest.call(this,a,d);f.call(this,"refresh",[a,d])}};return e});